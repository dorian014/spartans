<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spartans - Performance Analytics</title>
    <link rel="icon" type="image/png" href="assets/logo_small.png">
    <link rel="shortcut icon" type="image/png" href="assets/logo_small.png">
    <link rel="apple-touch-icon" href="assets/logo_small.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body class="dashboard">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-container">
            <div class="header-left">
                <img src="assets/logo_lar.png" alt="Spartans Logo" class="header-logo-large">
            </div>

            <div class="header-center">
                <div class="filter-section">
                    <div class="filter-group">
                        <label>Agents</label>
                        <div class="multi-select-wrapper">
                            <button id="agentFilterBtn" class="multi-select-toggle">
                                <span id="selectedAgentsText">All Agents</span>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="agentDropdown" class="multi-select-dropdown">
                                <div class="dropdown-header">
                                    <button id="selectAllAgents" class="select-all-btn">Select All</button>
                                    <button id="clearAllAgents" class="clear-all-btn">Clear All</button>
                                </div>
                                <div id="agentsList" class="dropdown-list">
                                    <!-- Agent checkboxes will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label for="dateRange">Date Range</label>
                        <select id="dateRange" class="date-range-select">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                            <option value="all">All time</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="header-right">
                <div class="data-status" id="dataStatus">
                    <div class="status-indicator" data-status="loading"></div>
                    <span class="status-text">Loading...</span>
                </div>

                <button id="logoutBtn" class="logout-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Sign Out</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="dashboard-main">
        <!-- Error State -->
        <div id="errorState" style="display: none; text-align: center; padding: 4rem 2rem;">
            <img src="assets/logo_small.png" alt="Spartans Logo" style="width: 150px; height: 150px; margin-bottom: 2rem; opacity: 0.5; filter: drop-shadow(0 0 20px rgba(233, 255, 0, 0.3));">
            <h2 style="color: #E9ff00; font-size: 2rem; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.1em;">Data Load Failed</h2>
            <p style="color: #a0a0a0; font-size: 1.125rem; margin-bottom: 2rem;">Unable to load dashboard data. Please try again.</p>
            <button onclick="location.reload()" style="padding: 0.75rem 2rem; background: #E9ff00; color: #000; border: none; border-radius: 0.5rem; font-weight: 600; text-transform: uppercase; cursor: pointer; transition: all 0.2s;">
                Retry
            </button>
        </div>

        <div class="container" id="dashboardContent">
            <!-- Stats Cards -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Total Posts</h3>
                            <p class="stat-value" id="totalPosts">-</p>
                            <p class="stat-change" id="postsChange">-</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Total Impressions</h3>
                            <p class="stat-value" id="totalImpressions">-</p>
                            <p class="stat-change" id="impressionsChange">-</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="2" x2="12" y2="6"></line>
                                <line x1="12" y1="18" x2="12" y2="22"></line>
                                <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
                                <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                                <line x1="2" y1="12" x2="6" y2="12"></line>
                                <line x1="18" y1="12" x2="22" y2="12"></line>
                                <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
                                <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Top 30 Posts/Day</h3>
                            <p class="stat-value" id="avgPostsPerDay">-</p>
                            <p class="stat-change">highest performers</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="8" r="7"></circle>
                                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Top Agent</h3>
                            <p class="stat-value" id="topAgent">-</p>
                            <p class="stat-change" id="topAgentStats">-</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="charts-section">
                <div class="chart-container timeline-chart">
                    <div class="chart-header">
                        <h3>Performance Timeline</h3>
                        <div class="chart-controls">
                            <button class="chart-toggle-btn active" data-metric="posts">Posts</button>
                            <button class="chart-toggle-btn" data-metric="impressions">Impressions</button>
                            <button class="chart-toggle-btn" data-metric="both">Both</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Posts by Agent</h3>
                            <button class="chart-sort-btn" data-sort="desc" title="Sort">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M7 10l5-5 5 5"></path>
                                    <path d="M7 14l5 5 5-5"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="postsChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Impressions by Agent</h3>
                            <button class="chart-sort-btn" data-sort="desc" title="Sort">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M7 10l5-5 5 5"></path>
                                    <path d="M7 14l5 5 5-5"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="impressionsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

<!-- Data Table Section -->
            <section class="table-section">
                <div class="section-header">
                    <h3>Detailed Performance Data</h3>
                    <div class="table-controls">
                        <div class="search-box">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input type="text" id="tableSearch" placeholder="Search agents, handles, or dates...">
                        </div>
                        <button id="exportBtn" class="export-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <span>Export CSV</span>
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table id="dataTable" class="data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-column="date">
                                    Date
                                    <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M7 10l5-5 5 5"></path>
                                        <path d="M7 14l5 5 5-5"></path>
                                    </svg>
                                </th>
                                <th class="sortable" data-column="agent">
                                    Agent
                                    <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M7 10l5-5 5 5"></path>
                                        <path d="M7 14l5 5 5-5"></path>
                                    </svg>
                                </th>
                                <th class="sortable" data-column="xHandle">
                                    X Handle
                                    <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M7 10l5-5 5 5"></path>
                                        <path d="M7 14l5 5 5-5"></path>
                                    </svg>
                                </th>
                                <th class="sortable" data-column="posts">
                                    Posts
                                    <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M7 10l5-5 5 5"></path>
                                        <path d="M7 14l5 5 5-5"></path>
                                    </svg>
                                </th>
                                <th class="sortable" data-column="impressions">
                                    Impressions
                                    <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M7 10l5-5 5 5"></path>
                                        <path d="M7 14l5 5 5-5"></path>
                                    </svg>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Table rows will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="table-pagination">
                    <div class="pagination-info">
                        Showing <span id="showingStart">0</span> - <span id="showingEnd">0</span> of <span id="totalRows">0</span> entries
                    </div>
                    <div class="pagination-controls">
                        <button id="prevPage" class="pagination-btn" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6"></polyline>
                            </svg>
                        </button>
                        <div id="pageNumbers" class="page-numbers">
                            <!-- Page numbers will be populated here -->
                        </div>
                        <button id="nextPage" class="pagination-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="dashboard-footer">
        <div class="footer-content">
            <div class="powered-by">
                <span>Powered by</span>
                <svg class="qstarlabs-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 236 44" fill="currentColor">
                    <path d="M161.583 34.9776C158.255 34.9776 157.141 33.7515 157.141 30.4192V9.01063H161.85V30.7022H170.139V34.9619H161.583V34.9776Z"/>
                    <path d="M188.617 23.9904C188.617 19.9507 185.697 16.9799 181.804 16.9799C177.91 16.9799 175.022 19.9507 175.022 23.9904C175.022 28.03 177.942 31.0322 181.804 31.0322C185.697 31.048 188.617 28.0772 188.617 23.9904ZM188.507 13.176H192.95V34.9776H188.507V32.164C186.984 34.1602 184.441 35.4334 181.364 35.4334C175.147 35.4334 170.296 30.655 170.296 24.0847C170.296 17.5143 175.147 12.7359 181.364 12.7359C184.284 12.7359 186.843 13.8834 188.507 15.9582V13.176Z"/>
                    <path d="M214.159 23.9904C214.159 19.9507 211.239 16.9799 207.377 16.9799C203.515 16.9799 200.564 19.9507 200.564 23.9904C200.564 28.03 203.484 31.0322 207.377 31.0322C211.239 31.048 214.159 28.0772 214.159 23.9904ZM218.9 24.0689C218.9 30.6393 214.081 35.4177 207.864 35.4177C204.756 35.4177 202.197 34.1602 200.674 32.1168V34.9776H196.262V9.01063H200.894V15.7224C202.479 13.8676 204.96 12.7202 207.848 12.7202C214.097 12.7202 218.9 17.5458 218.9 24.0689Z"/>
                    <path d="M220.376 28.4387H224.929C225.117 30.4349 226.483 31.6295 228.257 31.6295C230.031 31.6295 231.224 30.5607 231.224 29.1146C231.224 27.2284 229.811 26.7097 226.483 25.8137C223.155 24.8863 220.596 22.9215 220.596 19.1333C220.596 15.3452 223.563 12.7202 227.959 12.7202C232.354 12.7202 235.149 15.2352 235.479 19.3534H230.926C230.816 17.5301 229.56 16.4612 227.959 16.4612C226.248 16.4612 225.149 17.5301 225.149 18.8347C225.149 20.5009 226.216 21.0667 229.623 22.0255C233.029 22.9844 235.73 25.0592 235.73 28.7373C235.73 32.8556 232.731 35.4177 228.21 35.4177C223.689 35.4177 220.643 32.8241 220.376 28.4387Z"/>
                    <path d="M70.6077 30.8908C65.7096 30.8908 61.7221 26.8983 61.7221 21.9941C61.7221 17.0899 65.7096 13.0974 70.6077 13.0974C75.5058 13.0974 79.4934 17.0899 79.4934 21.9941C79.4934 23.9118 78.8811 25.688 77.845 27.1498L75.8826 25.185H70.1367L74.7837 29.8376C73.5434 30.4978 72.1148 30.8908 70.6077 30.8908ZM85.6787 34.9776L81.0789 30.3721C82.9157 28.0772 84.0147 25.1535 84.0147 21.9941C84.0147 14.575 78.0176 8.57051 70.6077 8.57051C63.1978 8.57051 57.2008 14.575 57.2008 21.9941C57.2008 29.4132 63.1978 35.4177 70.6077 35.4177C73.3707 35.4177 75.9454 34.5846 78.0804 33.1385L79.9172 34.9776H85.6787Z"/>
                    <path d="M114.879 30.8908C112.728 30.8908 111.802 30.6393 111.802 28.4858L111.833 18.9133H114.973V14.8422H111.833V9.08922H107.249V28.5487C107.249 33.6729 110.106 34.9619 114.172 34.9619H115.177V30.8908H114.879Z"/>
                    <path d="M134.864 23.9904C134.864 19.9507 131.944 16.9799 128.05 16.9799C124.157 16.9799 121.268 19.9507 121.268 23.9904C121.268 28.03 124.188 31.0322 128.05 31.0322C131.928 31.048 134.864 28.0772 134.864 23.9904ZM134.754 13.176H139.197V34.9776H134.754V32.164C133.231 34.1602 130.688 35.4334 127.611 35.4334C121.394 35.4334 116.543 30.655 116.543 24.0847C116.543 17.5143 121.394 12.7359 127.611 12.7359C130.531 12.7359 133.09 13.8834 134.754 15.9582V13.176Z"/>
                    <path d="M153.812 12.9403V17.4986H153.546C150.327 17.4986 147.109 18.6775 147.109 24.9177V34.9619H142.525V13.176H146.889V16.3983C148.192 14.1663 150.547 12.956 153.624 12.956H153.812V12.9403Z"/>
                    <path d="M87.1545 27.1183H91.8956C92.1624 29.9005 93.8579 31.378 96.15 31.378C98.442 31.378 99.745 29.9634 99.745 28.0772C99.745 25.5936 98.1124 24.7448 94.376 23.6603C90.5611 22.5914 87.5312 20.5009 87.5312 16.0525C87.5312 11.6042 90.8594 8.57051 95.7889 8.57051C100.718 8.57051 103.78 11.4313 104.188 16.3197H99.4782C99.2898 13.9148 97.7356 12.6102 95.7732 12.6102C93.8108 12.6102 92.288 13.9148 92.288 15.7224C92.288 17.9545 93.7637 18.6932 97.3588 19.7935C101.205 20.941 104.549 23.4245 104.549 27.6528C104.549 32.5098 101.142 35.402 96.1029 35.402C90.8908 35.4177 87.5155 32.3369 87.1545 27.1183Z"/>
                    <path d="M22.2548 2.73895L24.1701 14.2135L36.6194 5.37966C28.3617 -1.80369 16.0537 -1.78797 7.79605 5.39538L20.1041 14.1034L22.2548 2.73895Z"/>
                    <path d="M41.4704 21.9312L30.0572 24.0218L38.8487 36.408C45.9917 28.1715 46.0231 15.8953 38.9115 7.64312L30.2927 20.0765L41.4704 21.9312Z"/>
                    <path d="M3.00786 21.9941L14.0913 20.1236L5.53539 7.69028C-1.51345 15.9425 -1.48206 28.1558 5.61389 36.3765L14.3111 24.0689L3.00786 21.9941Z"/>
                    <path d="M44.2177 44L24.123 30.1677L22.2391 41.0449L22.2077 41.2021L20.2297 30.2306L7.90594 38.6871C12.0191 42.2238 17.137 44 22.2391 44H44.2177Z"/>
                </svg>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Loading dashboard data...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script>
        // Chart configuration - Spartans theme
        const CONFIG = {
            chartColors: {
                primary: '#E9ff00',      // Spartans lime/yellow
                secondary: '#007b8d',    // Teal
                accent: '#faf4e3',       // Cream accent
                background: 'rgba(233, 255, 0, 0.1)',
                grid: 'rgba(0, 123, 141, 0.1)'
            },
            dataUpdateThreshold: 3600000,
            rowsPerPage: 20,
            dataEndpoint: './data/data.json'
        };
    </script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>